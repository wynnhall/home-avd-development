---

# All management vlans on Spine switches.

svi_profiles:
  - profile: svi_l3_defaults
    raw_eos_cli: |
      no ip proxy-arp
      no autostate

tenants:
  - name: MGMT_TENANTS
    l2vlans:
      - id: 1000
        name: 'Native_VLAN'
        tags: [DC&MDF,SM1,ADMIN,SUPPORT,OOB,DMF]
    vrfs:
      - name: default
        ip_helpers:
          - ip_helper: 158.218.194.13
          - ip_helper: 172.16.169.30
        svis:
          - id: 461
            name: '10.211.240.0/22-SM1-Mgmt' # TBA
            tags: [SM1]
            enabled: true
            profile: svi_l3_defaults
            ip_virtual_router_addresses:
              - 10.211.240.1
            nodes:
              - node: ismmgtsp01a
                ip_address: 10.211.240.2/22
              - node: ismmgtsp02a
                ip_address: 10.211.240.3/22
          - id: 462
            name: '10.215.241.0/24-ADMIN-Mgmt' #TBA
            tags: [ADMIN]
            enabled: true
            profile: svi_l3_defaults
            ip_virtual_router_addresses:
              - 10.215.241.1
            nodes:
              - node: ismmgtsp01a
                ip_address: 10.215.241.2/24
              - node: ismmgtsp02a
                ip_address: 10.215.241.3/24
          - id: 463
            name: '10.215.242.0/23-SUPPORT-Mgmt'
            tags: [SUPPORT]
            enabled: true
            profile: svi_l3_defaults
            ip_virtual_router_addresses:
              - 10.215.242.1
            nodes:
              - node: ismmgtsp01a
                ip_address: 10.215.242.2/23
              - node: ismmgtsp02a
                ip_address: 10.215.242.3/23
          - id: 300
            name: '10.210.80.0/21-DC&MDF-Mgmt'
            tags: [DC&MDF]
            enabled: true
            profile: svi_l3_defaults
            ip_virtual_router_addresses:
              - 10.210.80.1
            nodes:
              - node: ismmgtsp01a
                ip_address: 10.210.80.2/21
              - node: ismmgtsp02a
                ip_address: 10.210.80.3/21
          - id: 240
            name: '10.210.20.0/24-SM-NMS-Servers'
            tags: [DC&MDF]
            enabled: true
            profile: svi_l3_defaults
            ip_virtual_router_addresses:
              - 10.210.20.1
            nodes:
              - node: ismmgtsp01a
                ip_address: 10.210.20.2/24
              - node: ismmgtsp02a
                ip_address: 10.210.20.3/24
          - id: 316
            name: '10.210.96.0/22-Serv-iLO-Mgmt'
            tags: [DC&MDF]
            enabled: true
            profile: svi_l3_defaults
            ip_virtual_router_addresses:
              - 10.210.96.1
            nodes:
              - node: ismmgtsp01a
                ip_address: 10.210.96.2/22
              - node: ismmgtsp02a
                ip_address: 10.210.96.3/22
          - id: 308
            name: '10.210.88.0/23-OOB-Mgmt'
            tags: [OOB]
            enabled: true
            profile: svi_l3_defaults
            ip_virtual_router_addresses:
              - 10.210.88.1
            nodes:
              - node: ismmgtsp01a
                ip_address: 10.210.88.2/23
              - node: ismmgtsp02a
                ip_address: 10.210.88.3/23
          - id: 443
            name: '10.210.223.0/24-DMF-Mgmt'
            tags: [DMF]
            enabled: true
            profile: svi_l3_defaults
            ip_virtual_router_addresses:
              - 10.210.223.1
            nodes:
              - node: ismmgtsp01a
                ip_address: 10.210.223.2/24
              - node: ismmgtsp02a
                ip_address: 10.210.223.3/24
          - id: 549
            name: 'MGMTFW-TRANSIT-DEFAULTVRF'
            enabled: true
            profile: svi_l3_defaults
            ip_virtual_router_addresses:
              - 10.210.241.89
            nodes:
              - node: ismmgtsp01a
                ip_address: 10.210.241.90/29
              - node: ismmgtsp02a
                ip_address: 10.210.241.91/29
        bgp_peer_groups:
          - name: MGMTFW-EBGP-PEERS
            nodes: [ismmgtsp01a, ismmgtsp02a]
            remote_as: "65120.511"
            maximum_routes: 0
        bgp_peers:
          - ip_address: 10.210.241.94
            peer_group: MGMTFW-EBGP-PEERS
            nodes:
                - ismmgtsp01a
                - ismmgtsp02a
            description: ismmgtpan01-02
            # changing next hop change is recommended via an outgoing route-map on sessions to the firewall for a faster failover
            set_ipv4_next_hop: 10.210.241.89
        # leveraging structured_config to add PLs & RMs from cli_gen to eos_designs tenants.vrfs and also to Add RM to the default "reditribute connected" under router.bgp   
        structured_config:
          prefix_lists:
            - name: PL-LOCAL-NETWORKS
              sequence_numbers:
                10:
                  action: "permit 10.208.0.0/13 le 29" # Supernet assigned to SM site
                20:
                  action: "permit 172.21.0.0/22 eq 32" # Supernet for Loopbacks at SM site
                30:
                  action: "permit 192.168.160.0/20 eq 32" # Global Loopbacks
                40:
                  action: "permit 10.44.5.0/24" # SCADA networks
                50:
                  action: "permit 10.74.56.0/21" # EHS
                60:
                  action: "permit 10.70.38.0/23" # Guestnet
                70:
                  action: "permit 10.72.40.0/24" # CPN84
          route_maps:
            - name: RM-LOCAL-NETWORKS
              sequence_numbers:
                - sequence: 10
                  type: permit
                  match:
                    - ip address prefix-list PL-LOCAL-NETWORKS
          router_bgp:
            redistribute_routes:
              - source_protocol: connected
                route_map: RM-LOCAL-NETWORKS
            peer_groups:
              - name: IPv4-UNDERLAY-PEERS
                type: null
                maximum_routes: null
                send_community: null
            address_family_ipv4:
              peer_groups:
                - name: IPv4-UNDERLAY-PEERS
                  activate: null
          eos_cli: |
            router bgp 65120.510
              no neighbor IPv4-UNDERLAY-PEERS peer group
        static_routes:
          - destination_address_prefix: 0.0.0.0/0
            gateway: 10.210.241.94
            name: ISMMGTPAN01-02
            metric: 225
            distance: 225
            nodes:
              - ismmgtsp01a
              - ismmgtsp02a
        redistribute_static: false
